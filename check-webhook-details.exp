#!/usr/bin/expect -f

set timeout 30
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
    "(yes/no)?" {
        send "yes\r"
        expect "password:"
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ç–∞–ª–∏ webhook –¥–ª—è –∑–∞–∫–∞–∑–∞
send "echo 'üîç –î–µ—Ç–∞–ª–∏ webhook –¥–ª—è –∑–∞–∫–∞–∑–∞ ORD-1762026621082:'\r"
expect "# "

send "pm2 logs trust-store --lines 500 --nostream | grep -A 15 'ORD-1762026621082' | grep -E 'amount|—Å—É–º–º–∞|paymentAmount|orderAmount|minAmount|Wrong|–Ω–µ–≤–µ—Ä–Ω–∞—è|‚úÖ|‚ùå' | tail -20\r"
expect "# "

send "echo ''\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –±—ã–ª–∞ –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã
send "echo 'üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ - —É—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π:'\r"
expect "# "

send "grep -A 5 'minAmount = orderAmount' server.js | head -10\r"
expect "# "

send "exit\r"
expect eof

