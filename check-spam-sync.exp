#!/usr/bin/expect -f

set timeout 20
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
send "pm2 logs trust-store --lines 100 --nostream | grep -E 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ|INBOX|Spam|Ð¡Ð¿Ð°Ð¼|Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾|ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾|ðŸ“§|ðŸ“¬|âœ…' | tail -30\r"
expect "# "

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¸ÑÐµÐ¼ Ð² Ð‘Ð”
send "node -e \"const db=require('better-sqlite3')('analytics.db');const count=db.prepare('SELECT COUNT(*) as c FROM email_messages').get();console.log('ÐŸÐ¸ÑÐµÐ¼ Ð² Ð‘Ð”:', count.c);const last=db.prepare('SELECT from_email,subject,created_at FROM email_messages ORDER BY created_at DESC LIMIT 5').all();last.forEach(e=>console.log(e.from_email+' - '+e.subject));\"\r"
expect "# "

send "exit\r"
expect eof


