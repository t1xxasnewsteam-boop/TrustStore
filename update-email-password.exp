#!/usr/bin/expect -f

set timeout 10
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# –û–±–Ω–æ–≤–ª—è–µ–º EMAIL_PASSWORD –≤ .env
send "sed -i 's/EMAIL_PASSWORD=.*/EMAIL_PASSWORD=Gaga007231/' .env\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
send "grep EMAIL_PASSWORD .env\r"
expect "# "

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º env
send "pm2 restart trust-store --update-env\r"
expect "# "

# –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
send "sleep 5 && pm2 logs trust-store --lines 30 --nostream | grep -E 'IMAP|email|üìß|üì¨|‚úÖ|‚ùå|–ø–æ–¥–∫–ª—é—á–µ–Ω|—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è' | tail -15\r"
expect "# "

send "exit\r"
expect eof


