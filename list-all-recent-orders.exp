#!/usr/bin/expect -f

set timeout 30
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
    "(yes/no)?" {
        send "yes\r"
        expect "password:"
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÑÐµ Ð·Ð°ÐºÐ°Ð·Ñ‹ Ñ‡ÐµÑ€ÐµÐ· node ÑÐºÑ€Ð¸Ð¿Ñ‚
send "echo 'ðŸ“‹ Ð’Ð¡Ð• ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð• Ð—ÐÐšÐÐ—Ð«:'\r"
expect "# "

send "node -e \"const Database = require('better-sqlite3'); const db = new Database('analytics.db'); const orders = db.prepare('SELECT order_id, customer_email, customer_name, status, total_amount, created_at FROM orders ORDER BY created_at DESC LIMIT 5').all(); console.log(JSON.stringify(orders, null, 2)); db.close();\" 2>/dev/null || echo 'ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð‘Ð”...'\r"
expect "# "

send "echo ''\r"
expect "# "

send "echo 'ðŸ” Ð˜Ñ‰ÐµÐ¼ Ð·Ð°ÐºÐ°Ð·Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 30 Ð¼Ð¸Ð½ÑƒÑ‚...'\r"
expect "# "

send "node -e \"const Database = require('better-sqlite3'); const db = new Database('analytics.db'); const thirtyMinAgo = new Date(Date.now() - 30*60*1000).toISOString(); const recent = db.prepare('SELECT order_id, customer_email, customer_name, status, total_amount, created_at FROM orders WHERE created_at > ? ORDER BY created_at DESC').all(thirtyMinAgo); console.log('ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²:', recent.length); recent.forEach((o, i) => console.log(\`\${i+1}. \${o.order_id} - \${o.customer_email} - \${o.status} - \${o.created_at}\`)); db.close();\" 2>/dev/null\r"
expect "# "

send "exit\r"
expect eof

