#!/usr/bin/expect -f

set timeout 15
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# –û–±–Ω–æ–≤–ª—è–µ–º EMAIL_PASSWORD –ø–∞—Ä–æ–ª–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
send "sed -i 's/EMAIL_PASSWORD=.*/EMAIL_PASSWORD=ceboidnvyelasoxd/' .env\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
send "grep EMAIL_PASSWORD .env\r"
expect "# "

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
send "pm2 restart trust-store --update-env\r"
expect "# "

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ IMAP
send "sleep 8 && pm2 logs trust-store --lines 30 --nostream | grep -E 'IMAP|üìß|üì¨|–ø–æ–¥–∫–ª—é—á–µ–Ω|—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è|‚úÖ|‚ùå|–°–ü–ê–ú|Spam' | tail -20\r"
expect "# "

send "exit\r"
expect eof


