#!/usr/bin/expect -f

set timeout 30
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∏—Å—å–º–∞ –≤ –ë–î
send "node -e 'const db=require(\"better-sqlite3\")(\"analytics.db\");const total=db.prepare(\"SELECT COUNT(*) as c FROM email_messages\").get();console.log(\"–í—Å–µ–≥–æ –ø–∏—Å–µ–º:\", total.c);const spam=db.prepare(\"SELECT COUNT(*) as c FROM email_messages WHERE subject LIKE \\\"%[–°–ü–ê–ú]%\\\"\").get();console.log(\"–ü–∏—Å–µ–º —Å [–°–ü–ê–ú]:\", spam.c);const last=db.prepare(\"SELECT from_email,subject,created_at FROM email_messages ORDER BY created_at DESC LIMIT 10\").all();console.log(\"\\n–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–∏—Å–µ–º:\");last.forEach(e=>console.log(e.from_email+\" - \"+e.subject));'\r"
expect "# "

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
send "pm2 logs trust-store --lines 100 --nostream | grep -E '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è|INBOX|Spam|–°–ø–∞–º|–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ|—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ|üìß|üì¨|üö®|‚úÖ' | tail -40\r"
expect "# "

send "exit\r"
expect eof


