#!/usr/bin/expect -f

set timeout 30
set server "root@45.95.234.173"
set password "o-4zWa6SFWUGo,"

spawn ssh $server

expect {
    "password:" {
        send "$password\r"
    }
    "(yes/no)?" {
        send "yes\r"
        expect "password:"
        send "$password\r"
    }
}

expect "# "

send "cd /root/TrustStore\r"
expect "# "

# ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð²ÑÐµ Ð¡Ð‘ÐŸ Ð·Ð°ÐºÐ°Ð·Ñ‹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ‡Ð°Ñ
send "echo 'ðŸ“‹ Ð’ÑÐµ Ð¡Ð‘ÐŸ Ð·Ð°ÐºÐ°Ð·Ñ‹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ‡Ð°Ñ:'\r"
expect "# "

send "node -e \"const Database = require('better-sqlite3'); const db = new Database('analytics.db'); const oneHourAgo = new Date(Date.now() - 60*60*1000).toISOString().replace('T', ' ').substring(0, 19); const orders = db.prepare('SELECT order_id, customer_email, customer_name, status, total_amount, created_at FROM orders WHERE payment_method = \\\"SBP\\\" AND created_at > ? ORDER BY created_at DESC').all(oneHourAgo); console.log(JSON.stringify(orders, null, 2)); db.close();\" 2>/dev/null\r"
expect "# "

send "exit\r"
expect eof

